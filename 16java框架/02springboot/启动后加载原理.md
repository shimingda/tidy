# 启动后加载原理

## 场景

### 在项目启动后，马上进行一些一次性的初始化工作，如读取加载资源文件、或者执行其它外部程序。

## Runner两种形式

### ApplicationRunner

```java
import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

@Component
public class RunAfterConfig implements ApplicationRunner {
	@Override 
	public void run(ApplicationArguments args) throws Exception{
		System.out.println("启动后执行");
	}
}

```

### CommandLineRunner

```java
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class RunAfterConfig implements CommandLineRunner{
    @Override 
    public void run(String... args) throws Exception{
    	System.out.println("启动后执行");
    }
}

```






## 实现原理

####     实现源码
    private void callRunners(ApplicationContext context, ApplicationArguments args) {
       List<Object> runners = new ArrayList();
        runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());
        runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());
        AnnotationAwareOrderComparator.sort(runners);
        Iterator var4 = (new LinkedHashSet(runners)).iterator();
    
        while(var4.hasNext()) {
            Object runner = var4.next();
            if (runner instanceof ApplicationRunner) {
                this.callRunner((ApplicationRunner)runner, args);
            }
    
            if (runner instanceof CommandLineRunner) {
                this.callRunner((CommandLineRunner)runner, args);
            }
        }
    
    }

- SpringApplication.run调用callRunners方法
- 查找实现了ApplicationRunner和CommandLineRunner接口的Bean，统一存放在一个list中
- 根据Bean的order进行排序
- 循环调用每一个Runner Bean的run接口。

